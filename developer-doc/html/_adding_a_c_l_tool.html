<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>PLUMED: How to add a new command-line tool</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../user-doc/html/index.html"> <img src="developer-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.11</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">How to add a new command-line tool </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>To implement a command line tool you need to create a single cpp file call CLToolNAME.cpp. You can, in a command line tool, use functionality from plumed to perform simple post-processing tasks. For example, sum_hills uses the functionality inside from inside the biasing <a class="el" href="class_p_l_m_d_1_1_action.html" title="Base class for all the input Actions.">PLMD::Action</a>, PLMD::BiasMetaD to calculate free energy surfaces. Regardless, of what you are endeavoring to do your CLToolNAME.cpp file should be formatted in accordance with the following template:</p>
<pre class="fragment">#include "CLTool.h"
#include "CLToolRegister.h"
#include "PlumedConfig.h"
#include "ActionRegister.h"

using namespace std;

namespace PLMD {
/**
//+PLUMEDOC TOOLS name
</pre><p>Insert the documentation for your new tool here</p>
<pre class="fragment">\par Examples
</pre><p>Insert some examples of how to use your tool here</p>
<pre class="fragment">*/
//+ENDPLUMEDOC

/******* This is how you should declare the class for your command line tool.  main() does
         all the analsysis you require. The constructor and the registerKeywords routine 
         only do anything if you are using one of the template forms of input described below.
         However, reigsterKeywords() must always be declared.

class CLToolNAME:
public CLTool
{
public:
  static void registerKeywords( Keywords&amp; keys );
  CLToolNAME(const CLToolOptions&amp; co );
  int main(FILE* in, FILE*out,Communicator&amp; pc);
  string description()const{
    return "a description of the particular kind of task CLToolNAME performs";
  }
};

PLUMED_REGISTER_CLTOOL(CLToolNAME,"name")
</pre><p>Insert the code for main, registerKeywords and the constructor here.</p>
<pre class="fragment">}  /--- don't forget to close the namespace PLMD { at the end of the file
</pre><h1><a class="anchor" id="input"></a>
Input</h1>
<p>The input stream is passed to main so you can create tools that have an input in any form. However, there are certain standardized forms of input that can be used for command line tools. If your tool takes its input in one of these forms we strongly encourage you to use the code that is already present. If you do so a great deal of manual generation will be looked after automatically.</p>
<p>There are two command line input types that are implemented in the base class. The first is for tools such as driver where the input is specified using a series of command line flags e.g.</p>
<pre class="fragment">plumed driver --plumed plumed.dat --ixyz trajectory.xyz --dump-forces
</pre><p>The other are tools like simplmd that take an input file that contains one directive per line and a corresponding value for that directive. For both these forms of input it is possible to read in everything that is required to run the calculation prior to the actual running of the calculation. In other words these the user is not prompted to provide input data once the main calculation has started running (N.B. you can do tools with input of this sort though as the input stream is passed to main). <br  />
</p>
<p>If you wish to use driver-like or simple-md like input then you have to specify this in the constructor. For driver-like input you would write the following for the constructor:</p>
<pre class="fragment">CLToolNAME::CLToolNAME(const CLToolOptions&amp; co ):
CLTool(co)
{
 inputdata=commandline;
}
</pre><p>For simplemd-like input you write the following for the constructor:</p>
<pre class="fragment">CLToolNAME( const CLToolOptions&amp; co ) :
CLTool(co)
{
  inputdata=ifile;
}
</pre><p>If you are not using one of these input forms then you don't need to write a constructor although you may choose to for reasons not connected to the input of data.</p>
<p>Once you have created the constructor the actual readin and manual creation is done in much the same manner as it is done for Actions in the main plumed code (<a class="el" href="using_doxygen.html">Creating plumed documentation</a>). You write a registerKeywords routine as follows:</p>
<pre class="fragment">void CLToolNAME::registerKeywords( Keywords&amp; keys ){
  CLTool::registerKeywords( keys );
}  
</pre><p>Inside this routine you add descriptions of all your various command-line flags (driver-like) or input directives (simple-md-like) and these descriptions are used to create the manual. The code will automatically check if a particular flag is present and read any input directive connected with a particular flag (i.e. the data after the space). Within main you can recover the read in data using CLTool::parse and CLTool:parseFlag. <br  />
</p>
<h1><a class="anchor" id="getplumed"></a>
Re-using plumed</h1>
<p>To re-use the functionality that is present in plumed you use the same tools that are used to patch the various MD codes (<a class="el" href="_how_to_plumed_your_m_d.html">How to add plumed to an MD code</a>). Alternatively, if you want to create an instance of a particular Action you can do so by issuing the following commands:</p>
<pre class="fragment">PlumedMain* plumed=new PlumedMain(); std::vector&lt;std::string&gt; words;
Action* action=actionRegister().create(ActionOptions(plumed,words));
delete plumed; delete action;
</pre><p>Please be aware that words should contain everything that would be required in an input line to make a valid instance of the Action you require. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
<table align="center" frame="void" width="98%" cellpadding="2%">
<tr><td align="left" valign="center"> 
Hosted by GitHub &nbsp;
<a href="http://github.com"><img src="octocat.png" width="88" height="66"  alt="GitHub Logo" /></a>
<!--Generated by  &#160; --> <a href="http://www.doxygen.org/index.html">
</td><td width=90% align="right">
<img class="footer" src="doxygen.png" alt="doxygen" align="right"/>
</a> 1.8.17
</td> </tr> 
</table>
</small></address>
</body>
</html>
