<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>PLUMED: WHAM</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script>
   var redpath = "";
   
   function showPath(eg,name) {
     var i; var y = document.getElementsByName(redpath);
     for (i=0; i < y.length; i++ ) { y[i].style.color="black"; }
     var x = document.getElementsByName(name); redpath=name;
     for (i = 0; i < x.length; i++) { x[i].style.color="red"; }
     var valid="value_details_".concat(eg);
     var valueField = document.getElementById(valid);
     var dataField = document.getElementById(name);
     valueField.innerHTML = dataField.innerHTML;
   }
   function swapInput(name) {
     var btn = document.getElementById(name + "_button");
     var mydiv = document.getElementById("input_" + name);
     if( btn.textContent=="expand shortcuts" ) {
         btn.textContent = "contract shortcuts";
         var dataField = document.getElementById(name + "long");
         mydiv.innerHTML = dataField.innerHTML;
     } else if( btn.textContent=="contract shortcuts" ) {
         btn.textContent = "expand shortcuts";
         var dataField = document.getElementById(name + "short");
         mydiv.innerHTML = dataField.innerHTML;
     }
   }
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.11.0-dev</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_w_h_a_m.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">WHAM </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><table align="center" frame="void" width="95%%" celpadding="5%%">
<tr>
<td width="60%%"></td><td><b> This is part of the wham <a class="el" href="mymodules.html">module </a></b>   </td></tr>
<tr>
<td width="60%%"></td><td><b> It is only available if you configure PLUMED with ./configure &ndash;enable-modules=wham . Furthermore, this feature is still being developed so take care when using it and report any problems on the mailing list.</b>   </td></tr>
</table>
<p>Calculate the weights for configurations using the weighted histogram analysis method.</p>
<p>Suppose that you have run multiple \(N\) trajectories each of which was computed by integrating a different biased Hamiltonian. We can calculate the probability of observing the set of configurations during the \(N\) trajectories that we ran using the product of multinomial distributions shown below: </p><p class="formulaDsp">
\[ P( \vec{T} ) \propto \prod_{j=1}^M \prod_{k=1}^N (c_k w_{kj} p_j)^{t_{kj}} \label{eqn:wham1} \]
</p>
<p> In this expression the second product runs over the biases that were used when calculating the \(N\) trajectories. The first product then runs over the \(M\) bins in our histogram. The \(p_j\) variable that is inside this product is the quantity we wish to extract; namely, the unbiased probability of having a set of CV values that lie within the range for the \(j\)th bin.</p>
<p>The quantity that we can easily extract from our simulations, \(t_{kj}\), however, measures the number of frames from trajectory \(k\) that are inside the \(j\)th bin. To interpret this quantity we must consider the bias that acts on each of the replicas so the \(w_{kj}\) term is introduced. This quantity is calculated as: </p><p class="formulaDsp">
\[ w_{kj} = \]
</p>
<p> and is essentially the factor that we have to multiply the unbiased probability of being in the bin by in order to get the probability that we would be inside this same bin in the \(k\)th of our biased simulations. Obviously, these \(w_{kj}\) values depend on the value that the CVs take and also on the particular trajectory that we are investigating all of which, remember, have different simulation biases. Finally, \(c_k\) is a free parameter that ensures that, for each \(k\), the biased probability is normalized.</p>
<p>We can use the equation for the probability that was given above to find a set of values for \(p_j\) that maximizes the likelihood of observing the trajectory. This constrained optimization must be performed using a set of Lagrange multipliers, \(\lambda_k\), that ensure that each of the biased probability distributions are normalized, that is \(\sum_j c_kw_{kj}p_j=1\). Furthermore, as the problem is made easier if the quantity in the equation above is replaced by its logarithm we actually chose to minimize </p><p class="formulaDsp">
\[ \mathcal{L}= \sum_{j=1}^M \sum_{k=1}^N t_{kj} \ln c_k w_{kj} p_j + \sum_k\lambda_k \left( \sum_{j=1}^N c_k w_{kj} p_j - 1 \right) \]
</p>
<p> After some manipulations the following (WHAM) equations emerge: </p><p class="formulaDsp">
\[ \begin{aligned} p_j &amp; \propto \frac{\sum_{k=1}^N t_{kj}}{\sum_k c_k w_{kj}} \\ c_k &amp; =\frac{1}{\sum_{j=1}^M w_{kj} p_j} \end{aligned} \]
</p>
<p> which can be solved by computing the \(p_j\) values using the first of the two equations above with an initial guess for the \(c_k\) values and by then refining these \(p_j\) values using the \(c_k\) values that are obtained by inserting the \(p_j\) values obtained into the second of the two equations above.</p>
<p>Notice that only \(\sum_k t_{kj}\), which is the total number of configurations from all the replicas that enter the \(j\)th bin, enters the WHAM equations above. There is thus no need to record which replica generated each of the frames. One can thus simply gather the trajectories from all the replicas together at the outset. This observation is important as it is the basis of the binless formulation of WHAM that is implemented within PLUMED.</p>
<dl class="section user"><dt>Examples</dt><dd></dd></dl>
<dl class="section user"><dt>Glossary of keywords and components</dt><dd></dd></dl>
<dl class="section user"><dt>Description of components</dt><dd></dd></dl>
<p>By default the value of the calculated quantity can be referenced elsewhere in the input file by using the label of the action. Alternatively this Action can be used to calculate the following quantities by employing the keywords listed below. These quantities can be referenced elsewhere in the input by using this Action's label followed by a dot and the name of the quantity required from the list below.</p>
<table align="center" frame="void" width="95%%" cellpadding="5%%">
<tr>
<td width="5%"><b> Quantity </b>  </td><td><b> Description </b>   </td></tr>
<tr>
<td width="15%"><b> .#!value </b> </td><td>the vector of WHAM weights to use for reweighting the elements in a time series   </td></tr>
</table>
<dl class="section user"><dt>Compulsory keywords</dt><dd></dd></dl>
<table align="center" frame="void" width="95%%" cellpadding="5%%">
<tr>
<td width="15%"><b> ARG </b> </td><td>the stored values for the bias   </td></tr>
<tr>
<td width="15%"><b> MAXITER </b> </td><td>( default=1000 ) maximum number of iterations for WHAM algorithm   </td></tr>
<tr>
<td width="15%"><b> WHAMTOL </b> </td><td>( default=1e-10 ) threshold for convergence of WHAM algorithm   </td></tr>
</table>
<dl class="section user"><dt>Options</dt><dd></dd></dl>
<table align="center" frame="void" width="95%%" cellpadding="5%%">
<tr>
<td width="15%"><b> TEMP </b> </td><td>the system temperature. This is not required if your MD code passes this quantity to PLUMED   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="_analysis.html">Analysis</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
