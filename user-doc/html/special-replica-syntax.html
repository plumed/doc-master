<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>PLUMED: Special replica syntax</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script>
   var redpath = "";
   
   function showPath(eg,name) {
     var i; var y = document.getElementsByName(redpath);
     for (i=0; i < y.length; i++ ) { y[i].style.color="black"; }
     var x = document.getElementsByName(name); redpath=name;
     for (i = 0; i < x.length; i++) { x[i].style.color="red"; }
     var valid="value_details_".concat(eg);
     var valueField = document.getElementById(valid);
     var dataField = document.getElementById(name);
     valueField.innerHTML = dataField.innerHTML;
   }
   function swapInput(name) {
     var btn = document.getElementById(name + "_button");
     var mydiv = document.getElementById("input_" + name);
     if( btn.textContent=="expand shortcuts" ) {
         btn.textContent = "contract shortcuts";
         var dataField = document.getElementById(name + "long");
         mydiv.innerHTML = dataField.innerHTML;
     } else if( btn.textContent=="contract shortcuts" ) {
         btn.textContent = "expand shortcuts";
         var dataField = document.getElementById(name + "short");
         mydiv.innerHTML = dataField.innerHTML;
     }
   }
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.11.0-dev</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('special-replica-syntax.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Special replica syntax </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>(this part of the manual is based on trieste-5-replica-special-syntax).</p>
<p>In many cases, we need to run multiple replicas with almost identical PLUMED files. These files might be prepared with cut-and-paste, which is very error prone, or could be set up with some smart bash or python script. Additionally, one can take advantage of the <a class="el" href="_i_n_c_l_u_d_e.html">INCLUDE</a> keyword so as to have a shared input file with common definitions and specific input files with replica-dependent keywords. However, as of PLUMED 2.4, we introduced a simpler manner to manipulate multiple replica inputs with tiny differences. Look at the following example:</p>

<div style="width: 80%; float:left" id="value_details_eg1"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><button type="button" id="eg1_button" onclick='swapInput("eg1")'>contract shortcuts</button></div><div style="width: 10%; float:left"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested on master" /></div><div style="width: 100%; float:left" id="input_eg1"></div>
<pre style="width: 97%;" class="fragment"></pre>
<script type="text/javascript">
if (window.addEventListener) { // Mozilla, Netscape, Firefox
    window.addEventListener('load', eg1Load, false);
} else if (window.attachEvent) { // IE
    window.attachEvent('onload', eg1Load);
}
function eg1Load(event) {
       swapInput("eg1");
}
</script>
<div style="display:none;" id="eg1short">
<pre style="width: 97%;" class="fragment">
<span style="color:blue">#SETTINGS NREPLICAS=3</span>
<span style="color:blue"># Compute a distance</span>
<b name="eg1shortd" onclick='showPath("eg1","eg1shortd")'>d: </b><a href="https://www.plumed.org/doc-master/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>=1,2 <span style="display:none;" id="eg1shortd">The DISTANCE action with label <b>d</b> calculates a single scalar value</span>
<span style="color:blue"># Apply a restraint.</span>
<a href="https://www.plumed.org/doc-master/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the values the harmonic restraint acts upon. <i></i></div></div>=<b name="eg1shortd">d</b> <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=@replicas:1.0,1.1,1.2 <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=1.0 <span style="display:none;" id="eg1short">The RESTRAINT action with label <b></b></span>
<span style="color:blue"># On replica 0, this means:</span>
<span style="color:blue"># RESTRAINT ARG=d AT=1.0 KAPPA=1.0</span>
<span style="color:blue"># On replica 1, this means:</span>
<span style="color:blue"># RESTRAINT ARG=d AT=1.1 KAPPA=1.0</span>
<span style="color:blue"># On replica 2, this means:</span>
<span style="color:blue"># RESTRAINT ARG=d AT=1.2 KAPPA=1.0</span>
</pre>
</div>
<div style="display:none;" id="eg1long"><pre style="width: 97%;" class="fragment">
<span style="color:blue">#SETTINGS NREPLICAS=3</span>
<span style="color:blue"># Compute a distance</span>
<b name="eg1longd" onclick='showPath("eg1","eg1longd")'>d: </b><a href="https://www.plumed.org/doc-master/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>=1,2 <span style="display:none;" id="eg1longd">The DISTANCE action with label <b>d</b> calculates a single scalar value</span>
<span style="color:blue"># Apply a restraint.</span>
<span style="color:blue"># On replica 0, this means:</span>
<span style="color:blue"># RESTRAINT ARG=d AT=1.0 KAPPA=1.0</span>
<span style="color:blue"># On replica 1, this means:</span>
<span style="color:blue"># RESTRAINT ARG=d AT=1.1 KAPPA=1.0</span>
<span style="color:blue"># On replica 2, this means:</span>
<span style="color:blue"># RESTRAINT ARG=d AT=1.2 KAPPA=1.0</span>
</pre>
</div>
<p>If you prepare a single <code>plumed.dat</code> file like this one and feeds it to PLUMED while using 3 replicas, the 3 replicas will see the very same input except for the <code>AT</code> keyword, that sets the position of the restraint. Replica 0 will see a restraint centered at 1.0, replica 1 centered at 1.1, and replica 2 centered at 1.2.</p>
<p>The <code>@replicas:</code> keyword is not special for <a class="el" href="_r_e_s_t_r_a_i_n_t.html">RESTRAINT</a> or for the <code>AT</code> keyword. Any keyword in PLUMED can accept that syntax. For instance, the following single input file can be used to setup a bias exchange metadynamics <a class="el" href="citelist.html#CITEREF_piana">[88]</a> simulations: </p>
<div style="width: 90%; float:left" id="value_details_eg2"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested on master" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue">#SETTINGS NREPLICAS=2</span>
<span style="color:blue"># Compute distance between atoms 1 and 2</span>
<b name="eg2d" onclick='showPath("eg2","eg2d")'>d: </b><a href="https://www.plumed.org/doc-master/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>=1,2 <span style="display:none;" id="eg2d">The DISTANCE action with label <b>d</b> calculates a single scalar value</span>
<span style="color:blue"># Compute a torsional angle</span>
<b name="eg2t" onclick='showPath("eg2","eg2t")'>t: </b><a href="https://www.plumed.org/doc-master/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=30,31,32,33 <span style="display:none;" id="eg2t">The TORSION action with label <b>t</b> calculates a single scalar value</span>
<span style="color:blue"># Metadynamics.</span>
<a href="https://www.plumed.org/doc-master/user-doc/html/_m_e_t_a_d.html" style="color:green">METAD</a> ...
   <div class="tooltip">ARG<div class="right"><b>compulsory keyword </b>
the labels of the scalars on which the bias will act <i></i></div></div>=@replicas:d,<b name="eg2t">t</b> 
   <div class="tooltip">HEIGHT<div class="right">the heights of the Gaussian hills. <i></i></div></div>=1.0 
   <div class="tooltip">PACE<div class="right"><b>compulsory keyword </b>
the frequency for hill addition <i></i></div></div>=100 
   <div class="tooltip">SIGMA<div class="right"><b>compulsory keyword </b>
the widths of the Gaussian hills <i></i></div></div>=@replicas:0.1,0.3 
   <div class="tooltip">GRID_MIN<div class="right">the lower bounds for the grid <i></i></div></div>=@replicas:0.0,-pi 
   <div class="tooltip">GRID_MAX<div class="right">the upper bounds for the grid <i></i></div></div>=@replicas:2.0,pi 
...<span style="display:none;" id="eg2">The METAD action with label <b></b></span>
<span style="color:blue"># On replica 0, this means:</span>
<span style="color:blue"># METAD ARG=d HEIGHT=1.0 PACE=100 SIGMA=0.1 GRID_MIN=0.0 GRID_MAX=2.0</span>
<span style="color:blue"># On replica 1, this means:</span>
<span style="color:blue"># METAD ARG=t HEIGHT=1.0 PACE=100 SIGMA=0.3 GRID_MIN=-pi GRID_MAX=pi</span>
</pre>
<p>This would be a typical setup for a bias exchange simulation. Notice that even though variables <code>d</code> and <code>t</code> are both read in both replicas, <code>d</code> is only computed on replica 0 (and <code>t</code> is only computed on replica 1). This is because variables that are defined but not used are never actually calculated by PLUMED.</p>
<p>If the value that should be provided for each replica is a vector, you should use curly braces as delimiters. For instance, if the restraint acts on two variables, you can use the following input:</p>

<div style="width: 80%; float:left" id="value_details_eg3"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><button type="button" id="eg3_button" onclick='swapInput("eg3")'>contract shortcuts</button></div><div style="width: 10%; float:left"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested on master" /></div><div style="width: 100%; float:left" id="input_eg3"></div>
<pre style="width: 97%;" class="fragment"></pre>
<script type="text/javascript">
if (window.addEventListener) { // Mozilla, Netscape, Firefox
    window.addEventListener('load', eg3Load, false);
} else if (window.attachEvent) { // IE
    window.attachEvent('onload', eg3Load);
}
function eg3Load(event) {
       swapInput("eg3");
}
</script>
<div style="display:none;" id="eg3short">
<pre style="width: 97%;" class="fragment">
<span style="color:blue">#SETTINGS NREPLICAS=3</span>
<span style="color:blue"># Compute distance between atoms 1 and 2</span>
<b name="eg3shortd" onclick='showPath("eg3","eg3shortd")'>d: </b><a href="https://www.plumed.org/doc-master/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>=10,20 <span style="display:none;" id="eg3shortd">The DISTANCE action with label <b>d</b> calculates a single scalar value</span>
<span style="color:blue"># Compute a torsional angle</span>
<b name="eg3shortt" onclick='showPath("eg3","eg3shortt")'>t: </b><a href="https://www.plumed.org/doc-master/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=30,31,32,33 <span style="display:none;" id="eg3shortt">The TORSION action with label <b>t</b> calculates a single scalar value</span>
<span style="color:blue"># Apply a restraint:</span>
<a href="https://www.plumed.org/doc-master/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> ...
   <div class="tooltip">ARG<div class="right">the values the harmonic restraint acts upon. <i></i></div></div>=<b name="eg3shortd">d</b>,<b name="eg3shortt">t</b> 
   <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=@replicas:{{1.0,2.0} {3.0,4.0} {5.0,6.0}}  
   <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=1.0,3.0 
...<span style="display:none;" id="eg3short">The RESTRAINT action with label <b></b></span>
<span style="color:blue"># On replica 0 this means:</span>
<span style="color:blue"># RESTRAINT ARG=d AT=1.0,2.0 KAPPA=1.0,3.0</span>
<span style="color:blue"># On replica 1 this means:</span>
<span style="color:blue"># RESTRAINT ARG=d AT=3.0,4.0 KAPPA=1.0,3.0</span>
<span style="color:blue"># On replica 2 this means:</span>
<span style="color:blue"># RESTRAINT ARG=d AT=5.0,6.0 KAPPA=1.0,3.0</span>
</pre>
</div>
<div style="display:none;" id="eg3long"><pre style="width: 97%;" class="fragment">
<span style="color:blue">#SETTINGS NREPLICAS=3</span>
<span style="color:blue"># Compute distance between atoms 1 and 2</span>
<b name="eg3longd" onclick='showPath("eg3","eg3longd")'>d: </b><a href="https://www.plumed.org/doc-master/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>=10,20 <span style="display:none;" id="eg3longd">The DISTANCE action with label <b>d</b> calculates a single scalar value</span>
<span style="color:blue"># Compute a torsional angle</span>
<b name="eg3longt" onclick='showPath("eg3","eg3longt")'>t: </b><a href="https://www.plumed.org/doc-master/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=30,31,32,33 <span style="display:none;" id="eg3longt">The TORSION action with label <b>t</b> calculates a single scalar value</span>
<span style="color:blue"># Apply a restraint:</span>
<span style="color:blue"># On replica 0 this means:</span>
<span style="color:blue"># RESTRAINT ARG=d AT=1.0,2.0 KAPPA=1.0,3.0</span>
<span style="color:blue"># On replica 1 this means:</span>
<span style="color:blue"># RESTRAINT ARG=d AT=3.0,4.0 KAPPA=1.0,3.0</span>
<span style="color:blue"># On replica 2 this means:</span>
<span style="color:blue"># RESTRAINT ARG=d AT=5.0,6.0 KAPPA=1.0,3.0</span>
</pre>
</div>
<p>Notice the double curly braces. The outer ones are used by PLUMED to know there the argument of the <code>AT</code> keyword ends, whereas the inner ones are used to group the values corresponding to each replica. Also notice that the last example can be split in multiple lines exploiting the fact that within multi-line statements (enclosed by pairs of <code>...</code>) newlines are replaced with simple spaces: </p>
<div style="width: 80%; float:left" id="value_details_eg4"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><button type="button" id="eg4_button" onclick='swapInput("eg4")'>contract shortcuts</button></div><div style="width: 10%; float:left"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested on master" /></div><div style="width: 100%; float:left" id="input_eg4"></div>
<pre style="width: 97%;" class="fragment"></pre>
<script type="text/javascript">
if (window.addEventListener) { // Mozilla, Netscape, Firefox
    window.addEventListener('load', eg4Load, false);
} else if (window.attachEvent) { // IE
    window.attachEvent('onload', eg4Load);
}
function eg4Load(event) {
       swapInput("eg4");
}
</script>
<div style="display:none;" id="eg4short">
<pre style="width: 97%;" class="fragment">
<span style="color:blue">#SETTINGS NREPLICAS=3</span>
<b name="eg4shortd" onclick='showPath("eg4","eg4shortd")'>d: </b><a href="https://www.plumed.org/doc-master/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>=10,20 <span style="display:none;" id="eg4shortd">The DISTANCE action with label <b>d</b> calculates a single scalar value</span>
<b name="eg4shortt" onclick='showPath("eg4","eg4shortt")'>t: </b><a href="https://www.plumed.org/doc-master/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=30,31,32,33 <span style="display:none;" id="eg4shortt">The TORSION action with label <b>t</b> calculates a single scalar value</span>
<a href="https://www.plumed.org/doc-master/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> ...
   <div class="tooltip">ARG<div class="right">the values the harmonic restraint acts upon. <i></i></div></div>=<b name="eg4shortd">d</b>,<b name="eg4shortt">t</b> 
   <span style="color:blue"># indentation is not required (this is not python!) </span>
   <span style="color:blue"># but makes the input easier to read </span>
   <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=@replicas:{ 
     {1.0,2.0} 
     {3.0,4.0} 
     {5.0,6.0} 
   }  
   <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=1.0,3.0 
...<span style="display:none;" id="eg4short">The RESTRAINT action with label <b></b></span>
</pre>
</div>
<div style="display:none;" id="eg4long"><p>In short, whenever there are keywords that should vary across replicas, you should set them using the <code>@replicas:</code> keyword. As mentioned above, you can always use the old syntax with separate input file, and this is recommended when the number of keywords that are different is large. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="_miscellaneous.html">Miscellaneous</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
