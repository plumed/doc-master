<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>PLUMED: benchmark</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script>
   var redpath = "";
   
   function showPath(eg,name) {
     var i; var y = document.getElementsByName(redpath);
     for (i=0; i < y.length; i++ ) { y[i].style.color="black"; }
     var x = document.getElementsByName(name); redpath=name;
     for (i = 0; i < x.length; i++) { x[i].style.color="red"; }
     var valid="value_details_".concat(eg);
     var valueField = document.getElementById(valid);
     var dataField = document.getElementById(name);
     valueField.innerHTML = dataField.innerHTML;
   }
   function swapInput(name) {
     var btn = document.getElementById(name + "_button");
     var mydiv = document.getElementById("input_" + name);
     if( btn.textContent=="expand shortcuts" ) {
         btn.textContent = "contract shortcuts";
         var dataField = document.getElementById(name + "long");
         mydiv.innerHTML = dataField.innerHTML;
     } else if( btn.textContent=="contract shortcuts" ) {
         btn.textContent = "expand shortcuts";
         var dataField = document.getElementById(name + "short");
         mydiv.innerHTML = dataField.innerHTML;
     }
   }
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.11.0-dev</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('benchmark.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">benchmark </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><table align="center" frame="void" width="95%%" celpadding="5%%">
<tr>
<td width="70%%"></td><td><b> This is part of the cltools <a class="el" href="mymodules.html">module </a></b>   </td></tr>
</table>
<p>benchmark is a lightweight reimplementation of driver focused on running benchmarks</p>
<p>The main difference wrt driver is that it generates a trajectory in memory rather than reading it from a file. This allows to better time the overhead of the plumed library, without including the time needed to read the trajectory.</p>
<p>It is also possible to load a separate version of the plumed kernel. This enables running benchmarks agaist previous plumed versions in a controlled setting, where systematic errors in the comparison are minimized.</p>
<dl class="section user"><dt>Examples</dt><dd></dd></dl>
<p>First, you should create a sample <code>plumed.dat</code> file for testing. For instance:</p>

<div style="width: 80%; float:left" id="value_details_eg1"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><button type="button" id="eg1_button" onclick='swapInput("eg1")'>contract shortcuts</button></div><div style="width: 10%; float:left"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested on master" /></div><div style="width: 100%; float:left" id="input_eg1"></div>
<pre style="width: 97%;" class="fragment"></pre>
<script type="text/javascript">
if (window.addEventListener) { // Mozilla, Netscape, Firefox
    window.addEventListener('load', eg1Load, false);
} else if (window.attachEvent) { // IE
    window.attachEvent('onload', eg1Load);
}
function eg1Load(event) {
       swapInput("eg1");
}
</script>
<div style="display:none;" id="eg1short">
<pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-master/user-doc/html/_w_h_o_l_e_m_o_l_e_c_u_l_e_s.html" style="color:green">WHOLEMOLECULES</a> <div class="tooltip">ENTITY0<div class="right">the atoms that make up a molecule that you wish to align. <i></i></div></div>=1-10000 <span style="display:none;" id="eg1short">The WHOLEMOLECULES action with label <b></b></span>
<b name="eg1shortp" onclick='showPath("eg1","eg1shortp")'>p: </b><a href="https://www.plumed.org/doc-master/user-doc/html/_p_o_s_i_t_i_o_n.html" style="color:green">POSITION</a> <div class="tooltip">ATOM<div class="right">the atom number. <i></i></div></div>=1 <span style="display:none;" id="eg1shortp">The POSITION action with label <b>p</b> calculates the following quantities:
<table  align="center" frame="void" width="95%%" cellpadding="5%%">
<tr><td width="5%%"><b> Quantity </b>  </td><td><b> Description </b> </td></tr>
<tr><td width="5%%">p.x</td><td>the x-component of the atom position</td></tr>
<tr><td width="5%%">p.y</td><td>the y-component of the atom position</td></tr>
<tr><td width="5%%">p.z</td><td>the z-component of the atom position</td></tr>
</table>
</span>
<a href="https://www.plumed.org/doc-master/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the values the harmonic restraint acts upon. <i></i></div></div>=<b name="eg1shortp">p.x</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=1 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=0 <span style="display:none;" id="eg1short">The RESTRAINT action with label <b></b></span>
</pre>
</div>
<div style="display:none;" id="eg1long"><pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-master/user-doc/html/_w_h_o_l_e_m_o_l_e_c_u_l_e_s.html" style="color:green">WHOLEMOLECULES</a> <div class="tooltip">ENTITY0<div class="right">the atoms that make up a molecule that you wish to align. <i></i></div></div>=1-10000 <span style="display:none;" id="eg1long">The WHOLEMOLECULES action with label <b></b></span>
<b name="eg1longp" onclick='showPath("eg1","eg1longp")'>p: </b><a href="https://www.plumed.org/doc-master/user-doc/html/_p_o_s_i_t_i_o_n.html" style="color:green">POSITION</a> <div class="tooltip">ATOM<div class="right">the atom number. <i></i></div></div>=1 <span style="display:none;" id="eg1longp">The POSITION action with label <b>p</b> calculates the following quantities:
<table  align="center" frame="void" width="95%%" cellpadding="5%%">
<tr><td width="5%%"><b> Quantity </b>  </td><td><b> Description </b> </td></tr>
<tr><td width="5%%">p.x</td><td>the x-component of the atom position</td></tr>
<tr><td width="5%%">p.y</td><td>the y-component of the atom position</td></tr>
<tr><td width="5%%">p.z</td><td>the z-component of the atom position</td></tr>
</table>
</span>
</pre>
</div>
<p>Then you can test the performance of this input with the following command: </p><pre class="fragment">plumed benchmark
</pre><p>You can also test a different (older) version of PLUMED with the same input. To do so, you should run </p><pre class="fragment">plumed-runtime benchmark --kernel /path/to/lib/libplumedKernel.so
</pre><dl class="section warning"><dt>Warning</dt><dd>It is necessary to use the <code>plumed-runtime</code> executable here to avoid conflicts between different plumed versions. You will find it in your path if you are using the non installed version of plumed, and in <code>$prefix/lib/plumed</code> if you installed plumed in $prefix,.</dd></dl>
<dl class="section user"><dt>Comparing multiple versions</dt><dd></dd></dl>
<p>The best way to compare two versions of plumed on the same input is to pass multiple colon-separated kernels:</p>
<pre class="fragment">plumed-runtime benchmark --kernel /path/to/lib/libplumedKernel.so:/path2/to/lib/libplumedKernel.so:this
</pre><p>Here <code>this</code> means the kernel of the version with which you are running the benchmark. This comparison runs the three instances simultaneously (alternating them) so that systematic differences in the load of your machine will affect them to the same extent.</p>
<p>In case the different versions require modified plumed.dat files, or if you simply want to compare two different plumed input files that compute the same thing, you can also use multiple plumed input files:</p>
<pre class="fragment">plumed-runtime benchmark --kernel /path/to/lib/libplumedKernel.so:this --plumed plumed1.dat:plumed2.dat
</pre><p>Similarly, you might want to run two different inputs using the same kernel, which can be obtained with:</p>
<pre class="fragment">plumed-runtime benchmark --plumed plumed1.dat:plumed2.dat
</pre><dl class="section user"><dt>Profiling</dt><dd></dd></dl>
<p>If you want to attach a profiler on the fly to the process, you might find it convenient to use <code>--nsteps -1</code>. The simulation will run forever and can be interrupted with CTRL-C. When interrupted, the result of the timers should be displayed anyway. You can also run setting a maximum time with <code>--maxtime</code>.</p>
<p>If you run a profiler when testing multiple PLUMED versions you might be confused by which function is from each version. It is recommended to recompile separate instances with a separate C++ namespace (<code>-DPLMD=PLUMED_version_1</code>) so that you will be able to distinguish them. In addition, compiling with <code>CXXFLAGS="-g -O3"</code> will make the profiling report more complete, likely including code lines.</p>
<dl class="section user"><dt>MPI runs</dt><dd></dd></dl>
<p>You can run emulating a domain decomposition. This is done automatically if plumed has been compiled with MPI and you run with <code>mpirun</code></p>
<pre class="fragment">mpirun -np 4 plumed-runtime benchmark
</pre><p>If you load separate PLUMED instances as discussed above, they should all be compiled against the same MPI version. Notice that when using MPI signals (CTRL-C) might not work.</p>
<p>Since some of the data transfer could happen asynchronously, you might want to use the <code>--sleep</code> option to simulate a lag between the <code>prepareCalc</code> and <code>performCalc</code> actions. This part of the calculation will not contribute to timer, but will obviously slow down your test.</p>
<dl class="section user"><dt>Output</dt><dd></dd></dl>
<p>In the output you will see the usual reports about timing produced by the internal timers of the tested plumed instances. In addition, this tool will monitor the timing externally, with some slightly different criterion:</p><ul>
<li>First, the initialization (construction of the input) will be shown with a separate timer, as well as the timing for the first step.</li>
<li>Second, the timer corresponding to the calculation will be split in three parts, reporting execution of the first 20% (warm-up) and the next two blocks of 40% each.</li>
<li>Finally, you might notice some discrepancy because some of the actions that are usually not expensive are not included in the internal timers. The external timer will thus provide a better estimate of the total elapsed time, including everything.</li>
</ul>
<p>The internal timers are still useful to monitor what happens at the different stages and, with <a class="el" href="_d_e_b_u_g.html">DEBUG</a> <code>DETAILED_TIMERS</code>, what happens in each action.</p>
<p>When you run multiple version, a comparative analisys of the time spent within PLUMED in the various instances will be done, showing the ratio between the total time and the time measured on the first instance, which will act as a reference. Errors will be estimated with bootstrapping. The warm-up phase will be discarded for this analysis.</p>
<dl class="section user"><dt>Glossary of keywords and components</dt><dd></dd></dl>
<dl class="section user"><dt>Compulsory keywords</dt><dd></dd></dl>
<table align="center" frame="void" width="95%%" cellpadding="5%%">
<tr>
<td width="15%"><b> <code>--plumed</code> </b> </td><td>( default=plumed.dat ) colon separated path(s) to the input file(s)   </td></tr>
<tr>
<td width="15%"><b> <code>--kernel</code> </b> </td><td>( default=this ) colon separated path(s) to kernel(s)   </td></tr>
<tr>
<td width="15%"><b> <code>--natoms</code> </b> </td><td>( default=100000 ) the number of atoms to use for the simulation   </td></tr>
<tr>
<td width="15%"><b> <code>--nsteps</code> </b> </td><td>( default=2000 ) number of steps of MD to perform (-1 means forever)   </td></tr>
<tr>
<td width="15%"><b> <code>--maxtime</code> </b> </td><td>( default=-1 ) maximum number of seconds (-1 means forever)   </td></tr>
<tr>
<td width="15%"><b> <code>--sleep</code> </b> </td><td>( default=0 ) number of seconds of sleep, mimicking MD calculation   </td></tr>
<tr>
<td width="15%"><b> <code>--atom-distribution</code> </b> </td><td>( default=line ) the kind of possible atomic displacement at each step   </td></tr>
</table>
<dl class="section user"><dt>Options</dt><dd></dd></dl>
<table align="center" frame="void" width="95%%" cellpadding="5%%">
<tr>
<td width="15%"><b> <code>--help/-h</code> </b> </td><td>( default=off ) print this help   </td></tr>
<tr>
<td width="15%"><b> <code>--domain-decomposition</code> </b> </td><td>( default=off ) simulate domain decomposition, implies &ndash;shuffle   </td></tr>
<tr>
<td width="15%"><b> <code>--shuffled</code> </b> </td><td><p class="starttd">( default=off ) reshuffle atoms  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td width="15%"><b> <code>--dump-trajectory</code> </b> </td><td>dump the trajectory to this file   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="tools.html">Command Line Tools</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
