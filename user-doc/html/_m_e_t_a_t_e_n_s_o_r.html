<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>PLUMED: METATENSOR</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script>
   var redpath = "";
   
   function showPath(eg,name) {
     var i; var y = document.getElementsByName(redpath);
     for (i=0; i < y.length; i++ ) { y[i].style.color="black"; }
     var x = document.getElementsByName(name); redpath=name;
     for (i = 0; i < x.length; i++) { x[i].style.color="red"; }
     var valid="value_details_".concat(eg);
     var valueField = document.getElementById(valid);
     var dataField = document.getElementById(name);
     valueField.innerHTML = dataField.innerHTML;
   }
   function swapInput(name) {
     var btn = document.getElementById(name + "_button");
     var mydiv = document.getElementById("input_" + name);
     if( btn.textContent=="expand shortcuts" ) {
         btn.textContent = "contract shortcuts";
         var dataField = document.getElementById(name + "long");
         mydiv.innerHTML = dataField.innerHTML;
     } else if( btn.textContent=="contract shortcuts" ) {
         btn.textContent = "expand shortcuts";
         var dataField = document.getElementById(name + "short");
         mydiv.innerHTML = dataField.innerHTML;
     }
   }
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.11.0-dev</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_m_e_t_a_t_e_n_s_o_r.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">METATENSOR </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><table align="center" frame="void" width="95%%" celpadding="5%%">
<tr>
<td width="60%%"></td><td><b> This is part of the metatensor <a class="el" href="mymodules.html">module </a></b>   </td></tr>
<tr>
<td width="60%%"></td><td><b> It is only available if you configure PLUMED with ./configure &ndash;enable-modules=metatensor . Furthermore, this feature is still being developed so take care when using it and report any problems on the mailing list.</b>   </td></tr>
</table>
<p>Use arbitrary machine learning models as collective variables.</p>
<p>Note that this action requires the metatensor-torch library. Check the instructions in the <a class="el" href="_m_e_t_a_t_e_n_s_o_r_m_o_d.html">Metatensor</a> page to enable this module.</p>
<p>This action enables the use of fully custom machine learning models — based on the <a href="https://docs.metatensor.org/latest/atomistic/index.html">metatensor atomistic models</a> interface — as collective variables in PLUMED. Such machine learning model are typically written and customized using Python code, and then exported to run within PLUMED as <a href="https://pytorch.org/docs/stable/jit.html">TorchScript</a>, which is a subset of Python that can be executed by the C++ torch library.</p>
<p>Metatensor offers a way to define such models and pass data from PLUMED (or any other simulation engine) to the model and back. For more information on how to define such model, have a look at the <a href="https://docs.metatensor.org/latest/examples/atomistic/index.html">corresponding tutorials</a>, or at the code in <code>regtest/metatensor/</code>. Each of the Python scripts in this directory defines a custom machine learning CV that can be used with PLUMED.</p>
<dl class="section user"><dt>Examples</dt><dd></dd></dl>
<p>The following input shows how you can call metatensor and evaluate the model that is described in the file <code>custom_cv.pt</code> from PLUMED.</p>

<div style="width: 90%; float:left" id="value_details_eg1"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/master-failed-red.svg" alt="tested on master" /></div><pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-master/user-doc/html/_s_p_e_c_i_e_s1_=1_-26.html" style="color:green">SPECIES1=1-26</a> <span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-master/user-doc/html/_s_p_e_c_i_e_s2_=27_-62.html" style="color:green">SPECIES2=27-62</a> <span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-master/user-doc/html/_s_p_e_c_i_e_s3_=63_-76.html" style="color:green">SPECIES3=63-76</a> <span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-master/user-doc/html/_s_p_e_c_i_e_s__t_o__t_y_p_e_s_=6_,1_,8.html" style="color:green">SPECIES_TO_TYPES=6,1,8</a> <span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-master/user-doc/html/_@_n_e_w_l_i_n_e.html" style="color:green">@newline</a> <span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>The numbered <code>SPECIES</code> labels are used to indicate the list of atoms that belong to each atomic species in the system. The <code>SPECIES_TO_TYPE</code> keyword then provides information on the atom type for each species. The first number here is the atomic type of the atoms that have been specified using the <code>SPECIES1</code> flag, the second number is the atomic number of the atoms that have been specified using the <code>SPECIES2</code> flag and so on.</p>
<p><code>METATENSOR</code> action also accepts the following options:</p>
<ul>
<li><code>EXTENSIONS_DIRECTORY</code> should be the path to a directory containing TorchScript extensions (as shared libraries) that are required to load and execute the model. This matches the <code>collect_extensions</code> argument to <code>MetatensorAtomisticModel.export</code> in Python.</li>
<li><code>CHECK_CONSISTENCY</code> can be used to enable internal consistency checks;</li>
<li><code>SELECTED_ATOMS</code> can be used to signal the metatensor models that it should only run its calculation for the selected subset of atoms. The model still need to know about all the atoms in the system (through the <code>SPECIES</code> keyword); but this can be used to reduce the calculation cost. Note that the indices of the selected atoms should start at 1 in the PLUMED input file, but they will be translated to start at 0 when given to the model (i.e. in Python/TorchScript, the <code>forward</code> method will receive a <code>selected_atoms</code> which starts at 0)</li>
</ul>
<p>Here is another example with all the possible keywords:</p>

<div style="width: 90%; float:left" id="value_details_eg2"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/master-failed-red.svg" alt="tested on master" /></div><pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-master/user-doc/html/_c_h_e_c_k__c_o_n_s_i_s_t_e_n_c_y.html" style="color:green">CHECK_CONSISTENCY</a> <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-master/user-doc/html/_s_p_e_c_i_e_s1_=1_-10.html" style="color:green">SPECIES1=1-10</a> <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-master/user-doc/html/_s_p_e_c_i_e_s2_=11_-20.html" style="color:green">SPECIES2=11-20</a> <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-master/user-doc/html/_s_p_e_c_i_e_s__t_o__t_y_p_e_s_=8_,13.html" style="color:green">SPECIES_TO_TYPES=8,13</a> <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># only run the calculation for the Aluminium (type 13) atoms, but</span>
<span style="color:blue"># include the Oxygen (type 8) as potential neighbors.</span>
<a href="https://www.plumed.org/doc-master/user-doc/html/_s_e_l_e_c_t_e_d__a_t_o_m_s_=11_-20.html" style="color:green">SELECTED_ATOMS=11-20</a> <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-master/user-doc/html/_@_n_e_w_l_i_n_e.html" style="color:green">@newline</a> <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<dl class="section user"><dt>Collective variables and metatensor models</dt><dd></dd></dl>
<p>PLUMED can use the <a href="https://docs.metatensor.org/latest/examples/atomistic/outputs/features.html"><code>"features"</code> output</a> of metatensor atomistic models as a collective variables. Alternatively, the code also accepts an output named <code>"plumed::cv"</code>, with the same metadata structure as the <code>"features"</code> output.</p>
<dl class="section user"><dt>Glossary of keywords and components</dt><dd></dd></dl>
<dl class="section user"><dt>Description of components</dt><dd></dd></dl>
<p>By default this Action calculates the following quantities. These quantities can be referenced elsewhere in the input by using this Action's label followed by a dot and the name of the quantity required from the list below.</p>
<table align="center" frame="void" width="95%%" cellpadding="5%%">
<tr>
<td width="5%"><b> Quantity </b>  </td><td><b> Description </b>   </td></tr>
<tr>
<td width="15%"><b> outputs </b> </td><td>collective variable created by the metatensor model   </td></tr>
<tr>
<td width="15%"><b> .#!value </b> </td><td>collective variable created by the metatensor model   </td></tr>
</table>
<dl class="section user"><dt>The atoms involved can be specified using</dt><dd></dd></dl>
<table align="center" frame="void" width="95%%" cellpadding="5%%">
<tr>
<td width="15%"><b> SPECIES </b> </td><td>the atoms in each PLUMED species. You can use multiple instances of this keyword i.e. SPECIES1, SPECIES2, SPECIES3...   </td></tr>
<tr>
<td width="15%"><b> SELECTED_ATOMS </b> </td><td>subset of atoms that should be used for the calculation   </td></tr>
</table>
<dl class="section user"><dt>Compulsory keywords</dt><dd></dd></dl>
<table align="center" frame="void" width="95%%" cellpadding="5%%">
<tr>
<td width="15%"><b> MODEL </b> </td><td>path to the exported metatensor model   </td></tr>
</table>
<dl class="section user"><dt>Options</dt><dd></dd></dl>
<table align="center" frame="void" width="95%%" cellpadding="5%%">
<tr>
<td width="15%"><b> NUMERICAL_DERIVATIVES </b> </td><td>( default=off ) calculate the derivatives for these quantities numerically   </td></tr>
<tr>
<td width="15%"><b> CHECK_CONSISTENCY </b> </td><td><p class="starttd">( default=off ) Should we enable internal consistency of the model  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td width="15%"><b> EXTENSIONS_DIRECTORY </b> </td><td>path to the directory containing TorchScript extensions to load   </td></tr>
<tr>
<td width="15%"><b> DEVICE </b> </td><td>Torch device to use for the calculation   </td></tr>
<tr>
<td width="15%"><b> SPECIES_TO_TYPES </b> </td><td>mapping from PLUMED SPECIES to metatensor's atomic types   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="_add_mod.html">Additional Modules</a></li><li class="navelem"><a class="el" href="_m_e_t_a_t_e_n_s_o_r_m_o_d.html">Metatensor</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
